<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Di√°rio Emocional - TCC</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5568d3;
            --secondary: #764ba2;
            --bg-light: #f8f9fa;
            --text-dark: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #48bb78;
            --danger: #f56565;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding-bottom: 80px;
            color: var(--text-dark);
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            color: var(--primary);
            text-align: center;
            margin-bottom: 5px;
        }

        .header p {
            text-align: center;
            font-size: 13px;
            color: var(--text-light);
        }

        .tabs {
            display: flex;
            background: white;
            box-shadow: 0 2px 5px var(--shadow);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: white;
            border: none;
            color: var(--text-light);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
            font-size: 15px;
        }

        .form-group label .emoji {
            font-size: 18px;
            margin-right: 5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .intensity-container {
            position: relative;
        }

        .intensity-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #48bb78, #ecc94b, #f56565);
            outline: none;
            -webkit-appearance: none;
        }

        .intensity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 5px var(--shadow);
            border: 3px solid var(--primary);
        }

        .intensity-value {
            text-align: center;
            margin-top: 10px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .emotions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .emotion-btn {
            padding: 15px 10px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .emotion-btn .emoji {
            display: block;
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .emocao-nome {
            font-weight: 600;
            font-size: 14px;
            display: block;
            margin-bottom: 3px;
        }
        
        .emocao-explicacao {
            font-size: 10px;
            opacity: 0.85;
            line-height: 1.3;
            font-weight: 400;
            display: block;
            color: var(--text-dark);
        }

        .emotion-btn.selected {
            border-color: var(--primary);
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px var(--shadow);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:active {
            background: var(--primary-dark);
            transform: scale(0.98);
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .btn-secondary:active {
            background: #e2e8f0;
            transform: scale(0.98);
        }

        .entries-list {
            margin-top: 10px;
        }

        .entry-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .entry-date {
            font-weight: 600;
            color: var(--primary);
            font-size: 16px;
        }

        .entry-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        .entry-field {
            margin-bottom: 15px;
        }

        .entry-field strong {
            display: block;
            color: var(--text-light);
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .entry-field p {
            color: var(--text-dark);
            line-height: 1.6;
        }

        .emotion-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: var(--bg-light);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state .emoji {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state p {
            color: var(--text-light);
            font-size: 16px;
        }

        .export-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px var(--shadow);
            text-align: center;
        }

        .export-section h3 {
            margin-bottom: 15px;
            color: var(--text-dark);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
        }

        .footer-info {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
        }

        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-dark);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            z-index: 1000;
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        @media (max-width: 380px) {
            .emotions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìî Di√°rio Emocional</h1>
        <p>Registro para Terapia Cognitivo-Comportamental</p>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('novo')">‚ûï Novo</button>
        <button class="tab" onclick="showTab('historico')">üìñ Hist√≥rico</button>
        <button class="tab" onclick="showTab('exportar')">üì§ Exportar</button>
    </div>

    <!-- TAB: NOVO REGISTRO -->
    <div id="novo" class="tab-content active">
        <div class="form-group">
            <label><span class="emoji">üìÖ</span> Data e Hora</label>
            <input type="datetime-local" id="dataHora">
        </div>

        <div class="form-group">
            <label><span class="emoji">üìç</span> Situa√ß√£o</label>
            <textarea id="situacao" placeholder="O que aconteceu? Onde voc√™ estava? Com quem?"></textarea>
        </div>

        <div class="form-group">
            <label><span class="emoji">üí≠</span> Pensamento Autom√°tico</label>
            <textarea id="pensamento" placeholder="O que passou pela sua cabe√ßa naquele momento?"></textarea>
        </div>

        <div class="form-group">
            <label><span class="emoji">‚ù§Ô∏è</span> Emo√ß√£o Principal</label>
            <div class="emotions-grid" id="emotionsGrid"></div>
        </div>

        <div id="intermediariasDiv"></div>
        <div id="especificasDiv"></div>

        <div class="form-group">
            <label><span class="emoji">üéöÔ∏è</span> Intensidade da Emo√ß√£o (0-10)</label>
            <div class="intensity-container">
                <input type="range" min="0" max="10" value="5" class="intensity-slider" id="intensidade">
                <div class="intensity-value" id="intensidadeValor">5</div>
            </div>
        </div>

        <div class="form-group">
            <label><span class="emoji">üé≠</span> Comportamento</label>
            <textarea id="comportamento" placeholder="Como voc√™ reagiu? O que fez depois?"></textarea>
        </div>

        <div class="btn-group">
            <button class="btn btn-secondary" onclick="limparFormulario()">üîÑ Limpar</button>
            <button class="btn btn-primary" onclick="salvarRegistro()">üíæ Salvar</button>
        </div>
    </div>

    <!-- TAB: HIST√ìRICO -->
    <div id="historico" class="tab-content">
        <div class="entries-list" id="entriesList"></div>
    </div>

    <!-- TAB: EXPORTAR -->
    <div id="exportar" class="tab-content">
        <div class="stats-grid" id="statsGrid"></div>
        
        <div class="export-section">
            <h3>üìä Exportar Dados</h3>
            <p style="color: var(--text-light); margin-bottom: 20px;">
                Baixe seus registros para compartilhar com seu terapeuta ou fazer backup
            </p>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="exportarPDF()">üìÑ PDF</button>
                <button class="btn btn-primary" onclick="exportarJSON()">JSON</button>
            </div>
            <div class="btn-group" style="margin-top: 10px;">
                <button class="btn btn-primary" onclick="exportarCSV()">CSV</button>
                <button class="btn btn-primary" onclick="exportarTexto()">Texto</button>
            </div>
        </div>

        <div class="export-section">
            <h3>‚öôÔ∏è Configura√ß√µes</h3>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="limparTodosDados()">üóëÔ∏è Limpar Tudo</button>
            </div>
        </div>

        <div class="footer-info">
            <p><strong>KEITE FABIOLA ‚Äì PSIC√ìLOGA 04/58498</strong></p>
            <p>@PSIKEITEFABIOLA | (31) 9 8681-4865</p>
            <p>keitefabiola@outlook.com</p>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const emocoesCores = {
            'Raiva': '#E18AB8',
            'Tristeza': '#4A63A5',
            'Surpresa': '#70C1CF',
            'Alegria': '#AFD799',
            'Amor': '#E7E26B',
            'Medo': '#E88C5B'
        };

        const emocoesCoresEspecificas = {
            '√ìdio': '#E18AB8',
            'Hostilidade': '#E18AB8',
            'Agita√ß√£o': '#E18AB8',
            'Frustra√ß√£o': '#E18AB8',
            'Irrita√ß√£o': '#E18AB8',
            'Provoca√ß√£o': '#E18AB8',
            'Ci√∫mes': '#E18AB8',
            'Ressentimento': '#E18AB8',
            'Desespero': '#E18AB8',
            'Revoltado': '#E18AB8',
            'Agoniado': '#4A63A5',
            'Machucado': '#4A63A5',
            'Depress√£o': '#4A63A5',
            'Pesar': '#4A63A5',
            'Consternado': '#4A63A5',
            'Desagradado': '#4A63A5',
            'Arrependimento': '#4A63A5',
            'Culpa': '#4A63A5',
            'Isolamento': '#4A63A5',
            'Solit√°rio': '#4A63A5',
            'Luto': '#4A63A5',
            'Impot√™ncia': '#4A63A5',
            'Chocado': '#70C1CF',
            'Desiludido': '#70C1CF',
            'Perplexo': '#70C1CF',
            'At√¥nito': '#70C1CF',
            'Impressionado': '#70C1CF',
            'Sem palavras': '#70C1CF',
            'Espantado': '#70C1CF',
            'Estimulado': '#70C1CF',
            'Tocado': '#70C1CF',
            'Gozo': '#AFD799',
            'Saciado': '#AFD799',
            'Divertido': '#AFD799',
            'Deleite': '#AFD799',
            'Jovial': '#AFD799',
            'Aben√ßoado': '#AFD799',
            'Triunfante': '#AFD799',
            'Famoso': '#AFD799',
            'Esperan√ßoso': '#AFD799',
            'Ansioso': '#AFD799',
            'Excitado': '#AFD799',
            'Zelo': '#AFD799',
            'J√∫bilo': '#AFD799',
            'Euforia': '#AFD799',
            '√äxtase': '#AFD799',
            'Sedu√ß√£o': '#AFD799',
            'Pleno': '#E7E26B',
            'Liberdade': '#E7E26B',
            'Compaix√£o': '#E7E26B',
            'Cuidado': '#E7E26B',
            'Fasc√≠nio': '#E7E26B',
            'Paix√£o': '#E7E26B',
            'Atra√ß√£o': '#E7E26B',
            'Sens√≠vel': '#E7E26B',
            'Carinho': '#E7E26B',
            'Rom√¢ntico': '#E7E26B',
            'Pavor': '#E88C5B',
            'Mortificado': '#E88C5B',
            'Ansiedade': '#E88C5B',
            'Preocupa√ß√£o': '#E88C5B',
            'Inadequa√ß√£o': '#E88C5B',
            'Inferioridade': '#E88C5B',
            'Histeria': '#E88C5B',
            'P√¢nico': '#E88C5B',
            'Amedrontado': '#E88C5B',
            'Abandono': '#E88C5B'
        };

        const emocoesExplicacoes = {
            // Raiva
            '√ìdio': 'Avers√£o intensa e profunda, desejo de afastar ou eliminar algo/algu√©m',
            'Hostilidade': 'Atitude antagonista e agressiva, postura de oposi√ß√£o',
            'Agita√ß√£o': 'Estado de inquieta√ß√£o e perturba√ß√£o, dificuldade de se acalmar',
            'Frustra√ß√£o': 'Sentimento de desapontamento quando expectativas n√£o s√£o atendidas',
            'Irrita√ß√£o': 'Inc√¥modo e impaci√™ncia com situa√ß√µes ou pessoas',
            'Provoca√ß√£o': 'Sensa√ß√£o de estar sendo testado ou desafiado de forma negativa',
            'Ci√∫mes': 'Receio de perder algo/algu√©m para outro, possessividade',
            'Ressentimento': 'M√°goa guardada, sentimento de injusti√ßa n√£o resolvido',
            'Desespero': 'Perda de esperan√ßa, sensa√ß√£o de n√£o haver sa√≠da',
            'Revoltado': 'Indigna√ß√£o extrema, rebeldia contra uma situa√ß√£o',
            
            // Tristeza
            'Agoniado': 'Sofrimento intenso, ang√∫stia emocional profunda',
            'Machucado': 'Ferido emocionalmente, dor emocional por algo que aconteceu',
            'Depress√£o': 'Estado de profunda tristeza e falta de energia/motiva√ß√£o',
            'Pesar': 'Sentimento de lamento e peso no cora√ß√£o',
            'Consternado': 'Perplexidade dolorosa, choque com algo negativo',
            'Desagradado': 'Descontentamento, falta de satisfa√ß√£o com situa√ß√£o',
            'Arrependimento': 'Remorso por algo que fez ou deixou de fazer',
            'Culpa': 'Sensa√ß√£o de responsabilidade por algo negativo, autocr√≠tica',
            'Isolamento': 'Sensa√ß√£o de estar separado dos outros, desconex√£o',
            'Solit√°rio': 'Sentimento de solid√£o, falta de companhia',
            'Luto': 'Dor pela perda de algu√©m ou algo importante',
            'Impot√™ncia': 'Sensa√ß√£o de n√£o ter poder para mudar a situa√ß√£o',
            
            // Surpresa
            'Chocado': 'Impacto emocional forte, dificuldade de processar o inesperado',
            'Desiludido': 'Decep√ß√£o ao perceber que algo n√£o era como parecia',
            'Perplexo': 'Confus√£o e incerteza diante do inesperado',
            'At√¥nito': 'Paralisado pela surpresa, estupefato',
            'Impressionado': 'Marcado positivamente por algo inesperado',
            'Sem palavras': 'Incapacidade de expressar o que sente diante da surpresa',
            'Espantado': 'Surpreso de forma intensa, admirado',
            'Estimulado': 'Energizado e motivado por algo novo',
            'Tocado': 'Emocionalmente afetado de forma sens√≠vel',
            
            // Alegria
            'Gozo': 'Prazer intenso, satisfa√ß√£o plena',
            'Saciado': 'Plenamente satisfeito, necessidades atendidas',
            'Divertido': 'Entretenimento e alegria por algo engra√ßado ou prazeroso',
            'Deleite': 'Prazer refinado, aprecia√ß√£o profunda',
            'Jovial': 'Alegria leve e descontra√≠da, bom humor',
            'Aben√ßoado': 'Gratid√£o por se sentir agraciado, sortudo',
            'Triunfante': 'Vit√≥ria e conquista, sensa√ß√£o de sucesso',
            'Famoso': 'Reconhecimento social, sentir-se valorizado por muitos',
            'Esperan√ßoso': 'Otimismo sobre o futuro, expectativa positiva',
            'Ansioso': 'Expectativa intensa (positiva) por algo desejado',
            'Excitado': 'Energia alta com antecipa√ß√£o positiva',
            'Zelo': 'Entusiasmo fervoroso, dedica√ß√£o apaixonada',
            'J√∫bilo': 'Alegria exuberante, celebra√ß√£o intensa',
            'Euforia': 'Felicidade extrema, √™xtase de alegria',
            '√äxtase': 'Estado m√°ximo de prazer e alegria',
            'Sedu√ß√£o': 'Atra√ß√£o magn√©tica, charme e encantamento',
            
            // Amor
            'Pleno': 'Completude interior, paz e satisfa√ß√£o profunda',
            'Liberdade': 'Sensa√ß√£o de autonomia e aus√™ncia de restri√ß√µes',
            'Compaix√£o': 'Empatia ativa, desejo de aliviar o sofrimento alheio',
            'Cuidado': 'Aten√ß√£o dedicada ao bem-estar de algu√©m',
            'Fasc√≠nio': 'Encantamento intenso, absor√ß√£o total',
            'Paix√£o': 'Amor intenso e ardente, desejo profundo',
            'Atra√ß√£o': 'Interesse magn√©tico por algu√©m, desejo de proximidade',
            'Sens√≠vel': 'Delicadeza emocional, receptividade afetiva',
            'Carinho': 'Afeto terno e gentil, ternura',
            'Rom√¢ntico': 'Amor idealizado, valoriza√ß√£o da beleza do relacionamento',
            
            // Medo
            'Pavor': 'Terror extremo, medo paralisante',
            'Mortificado': 'Constrangimento profundo misturado com medo',
            'Ansiedade': 'Apreens√£o com o futuro, preocupa√ß√£o antecipada',
            'Preocupa√ß√£o': 'Inquieta√ß√£o com poss√≠veis problemas',
            'Inadequa√ß√£o': 'Sensa√ß√£o de n√£o ser bom o suficiente',
            'Inferioridade': 'Sentir-se menor ou pior que os outros',
            'Histeria': 'Rea√ß√£o de medo descontrolada, perda de controle emocional',
            'P√¢nico': 'Medo s√∫bito e avassalador, rea√ß√£o de fuga',
            'Amedrontado': 'Estado de medo persistente, intimida√ß√£o',
            'Abandono': 'Medo de ser deixado sozinho, rejei√ß√£o'
        };

        const emocoesHierarquia = {
            'Raiva': {
                emoji: 'üò†',
                intermediarias: {
                    'Furioso': ['√ìdio', 'Hostilidade'],
                    'Exasperado': ['Agita√ß√£o', 'Frustra√ß√£o'],
                    'Irritado': ['Irrita√ß√£o', 'Provoca√ß√£o'],
                    'Inveja': ['Ci√∫mes', 'Ressentimento'],
                    'Desgosto': ['Desespero', 'Revoltado']
                }
            },
            'Tristeza': {
                emoji: 'üò¢',
                intermediarias: {
                    'Sofrimento': ['Agoniado', 'Machucado'],
                    'Tristeza': ['Depress√£o', 'Pesar'],
                    'Desapontamento': ['Consternado', 'Desagradado'],
                    'Vergonha': ['Arrependimento', 'Culpa'],
                    'Neglig√™ncia': ['Isolamento', 'Solit√°rio'],
                    'Desespero': ['Luto', 'Impot√™ncia']
                }
            },
            'Surpresa': {
                emoji: 'üò≤',
                intermediarias: {
                    'Atordoamento': ['Chocado', 'Consternado'],
                    'Confus√£o': ['Desiludido', 'Perplexo'],
                    'Espanto': ['At√¥nito', 'Impressionado'],
                    'Supera√ß√£o': ['Sem palavras', 'Espantado'],
                    'Abalado': ['Estimulado', 'Tocado']
                }
            },
            'Alegria': {
                emoji: 'üòä',
                intermediarias: {
                    'Satisfeito': ['Gozo', 'Saciado'],
                    'Feliz': ['Divertido', 'Deleite'],
                    'Animado': ['Aben√ßoado', 'Jovial'],
                    'Orgulhoso': ['Famoso', 'Triunfante'],
                    'Otimista': ['Esperan√ßoso', 'Ansioso'],
                    'Entusiasmo': ['Zelo', 'Excitado'],
                    'Exaltado': ['J√∫bilo', 'Euforia'],
                    'Encantado': ['√äxtase', 'Sedu√ß√£o']
                }
            },
            'Amor': {
                emoji: 'ü•∞',
                intermediarias: {
                    'Pac√≠fico': ['Pleno', 'Liberdade'],
                    'Afetuoso': ['Compaix√£o', 'Cuidado'],
                    'Desejoso': ['Fasc√≠nio', 'Paix√£o'],
                    'Nost√°lgico': ['Atra√ß√£o', 'Sens√≠vel'],
                    'Encantado': ['Carinho', 'Rom√¢ntico']
                }
            },
            'Medo': {
                emoji: 'üò®',
                intermediarias: {
                    'Horrorizado': ['Pavor', 'Mortificado'],
                    'Nervoso': ['Ansiedade', 'Preocupa√ß√£o'],
                    'Inseguro': ['Inadequa√ß√£o', 'Inferioridade'],
                    'Aterrorizado': ['Histeria', 'P√¢nico'],
                    'Assustado': ['Amedrontado', 'Abandono']
                }
            }
        };

        let emocaoSelecionada = {
            central: '',
            intermediaria: '',
            especifica: ''
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            inicializarApp();
        });

        function inicializarApp() {
            const agora = new Date();
            agora.setMinutes(agora.getMinutes() - agora.getTimezoneOffset());
            document.getElementById('dataHora').value = agora.toISOString().slice(0, 16);

            criarGridEmocoes();
            configurarSliderIntensidade();
            carregarHistorico();
            atualizarEstatisticas();
        }

        function criarGridEmocoes() {
            const grid = document.getElementById('emotionsGrid');
            const emocoesCentrais = Object.keys(emocoesHierarquia);
            
            grid.innerHTML = emocoesCentrais.map(nome => {
                const cor = emocoesCores[nome];
                return `
                    <button class="emotion-btn" onclick="selecionarEmocaoCentral('${nome}', this)" 
                            style="border-color: ${cor}20; background: ${cor}10;">
                        <span class="emoji">${emocoesHierarquia[nome].emoji}</span>
                        ${nome}
                    </button>
                `;
            }).join('');
        }

        function selecionarEmocaoCentral(nome, btn) {
            document.querySelectorAll('.emotion-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            emocaoSelecionada.central = nome;
            emocaoSelecionada.intermediaria = '';
            emocaoSelecionada.especifica = '';
            
            // Mostrar emo√ß√µes intermedi√°rias
            const intermediariasDiv = document.getElementById('intermediariasDiv');
            const intermediarias = Object.keys(emocoesHierarquia[nome].intermediarias);
            const cor = emocoesCores[nome];
            
            intermediariasDiv.innerHTML = `
                <div class="form-group">
                    <label><span class="emoji">üéØ</span> Qual tipo de ${nome}?</label>
                    <div class="emotions-grid" id="intermediariasGrid">
                        ${intermediarias.map(inter => `
                            <button class="emotion-btn" onclick="selecionarIntermediaria('${inter}', this)"
                                    style="border-color: ${cor}40; background: ${cor}15;">
                                ${inter}
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Limpar emo√ß√µes espec√≠ficas
            document.getElementById('especificasDiv').innerHTML = '';
        }

        function selecionarIntermediaria(nome, btn) {
            document.querySelectorAll('#intermediariasGrid .emotion-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            emocaoSelecionada.intermediaria = nome;
            emocaoSelecionada.especifica = '';
            
            // Mostrar emo√ß√µes espec√≠ficas
            const especificasDiv = document.getElementById('especificasDiv');
            const especificas = emocoesHierarquia[emocaoSelecionada.central].intermediarias[nome];
            const cor = emocoesCores[emocaoSelecionada.central];
            
            especificasDiv.innerHTML = `
                <div class="form-group">
                    <label><span class="emoji">üîç</span> Mais especificamente:</label>
                    <div class="emotions-grid" id="especificasGrid">
                        ${especificas.map(esp => {
                            const corEspecifica = emocoesCoresEspecificas[esp] || cor;
                            const explicacao = emocoesExplicacoes[esp] || '';
                            return `
                                <button class="emotion-btn" onclick="selecionarEspecifica('${esp}', this)"
                                        style="border-color: ${corEspecifica}; background: ${corEspecifica}30;">
                                    <span class="emocao-nome">${esp}</span>
                                    <span class="emocao-explicacao">${explicacao}</span>
                                </button>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function selecionarEspecifica(nome, btn) {
            document.querySelectorAll('#especificasGrid .emotion-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            emocaoSelecionada.especifica = nome;
        }

        function configurarSliderIntensidade() {
            const slider = document.getElementById('intensidade');
            const valor = document.getElementById('intensidadeValor');
            slider.oninput = () => valor.textContent = slider.value;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'historico') carregarHistorico();
            if (tabName === 'exportar') atualizarEstatisticas();
        }

        function salvarRegistro() {
            const dataHora = document.getElementById('dataHora').value;
            const situacao = document.getElementById('situacao').value.trim();
            const pensamento = document.getElementById('pensamento').value.trim();
            const intensidade = document.getElementById('intensidade').value;
            const comportamento = document.getElementById('comportamento').value.trim();

            if (!dataHora || !situacao || !pensamento || !emocaoSelecionada.central || !emocaoSelecionada.intermediaria || !emocaoSelecionada.especifica || !comportamento) {
                mostrarToast('‚ö†Ô∏è Preencha todos os campos, incluindo todos os n√≠veis da emo√ß√£o!');
                return;
            }

            const registro = {
                id: Date.now(),
                dataHora,
                situacao,
                pensamento,
                emocaoCentral: emocaoSelecionada.central,
                emocaoIntermediaria: emocaoSelecionada.intermediaria,
                emocaoEspecifica: emocaoSelecionada.especifica,
                intensidade,
                comportamento
            };

            const registros = getRegistros();
            registros.push(registro);
            localStorage.setItem('diarioEmocional', JSON.stringify(registros));

            mostrarToast('‚úÖ Registro salvo com sucesso!');
            limparFormulario();
            setTimeout(() => showTab('historico'), 1500);
        }

        function limparFormulario() {
            document.getElementById('situacao').value = '';
            document.getElementById('pensamento').value = '';
            document.getElementById('comportamento').value = '';
            document.getElementById('intensidade').value = 5;
            document.getElementById('intensidadeValor').textContent = '5';
            document.querySelectorAll('.emotion-btn').forEach(b => b.classList.remove('selected'));
            emocaoSelecionada = {
                central: '',
                intermediaria: '',
                especifica: ''
            };
            document.getElementById('intermediariasDiv').innerHTML = '';
            document.getElementById('especificasDiv').innerHTML = '';
            
            const agora = new Date();
            agora.setMinutes(agora.getMinutes() - agora.getTimezoneOffset());
            document.getElementById('dataHora').value = agora.toISOString().slice(0, 16);
        }

        function getRegistros() {
            return JSON.parse(localStorage.getItem('diarioEmocional') || '[]');
        }

        function carregarHistorico() {
            const registros = getRegistros().sort((a, b) => new Date(b.dataHora) - new Date(a.dataHora));
            const lista = document.getElementById('entriesList');

            if (registros.length === 0) {
                lista.innerHTML = `
                    <div class="empty-state">
                        <div class="emoji">üìù</div>
                        <p>Nenhum registro ainda.<br>Comece fazendo seu primeiro registro!</p>
                    </div>
                `;
                return;
            }

            lista.innerHTML = registros.map(r => {
                const data = new Date(r.dataHora);
                const dataFormatada = data.toLocaleDateString('pt-BR');
                const horaFormatada = data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
                
                // Suporte para registros antigos e novos
                const emocaoCentral = r.emocaoCentral || r.emocao || 'N√£o especificada';
                const emocaoIntermediaria = r.emocaoIntermediaria || '';
                const emocaoEspecifica = r.emocaoEspecifica || '';
                const cor = emocoesCores[emocaoCentral] || '#667eea';
                const emojiEmocao = emocoesHierarquia[emocaoCentral]?.emoji || '‚ù§Ô∏è';

                return `
                    <div class="entry-card">
                        <div class="entry-header">
                            <div class="entry-date">üìÖ ${dataFormatada} √†s ${horaFormatada}</div>
                            <div class="entry-actions">
                                <button class="icon-btn" onclick="deletarRegistro(${r.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="entry-field">
                            <strong>Situa√ß√£o</strong>
                            <p>${r.situacao}</p>
                        </div>
                        
                        <div class="entry-field">
                            <strong>Pensamento Autom√°tico</strong>
                            <p>${r.pensamento}</p>
                        </div>
                        
                        <div class="entry-field">
                            <strong>Emo√ß√£o e Intensidade</strong>
                            <div class="emotion-badge" style="background: ${cor}15; border: 2px solid ${cor}40; flex-wrap: wrap;">
                                <span style="font-size: 20px;">${emojiEmocao}</span>
                                <span style="font-weight: bold; color: ${cor};">${emocaoCentral}</span>
                                ${emocaoIntermediaria ? `<span>‚Üí ${emocaoIntermediaria}</span>` : ''}
                                ${emocaoEspecifica ? `<span>‚Üí ${emocaoEspecifica}</span>` : ''}
                            </div>
                            <div style="margin-top: 8px; font-weight: bold; color: ${cor}; font-size: 18px;">
                                Intensidade: ${r.intensidade}/10
                            </div>
                        </div>
                        
                        <div class="entry-field">
                            <strong>Comportamento</strong>
                            <p>${r.comportamento}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deletarRegistro(id) {
            if (!confirm('Tem certeza que deseja deletar este registro?')) return;
            
            const registros = getRegistros().filter(r => r.id !== id);
            localStorage.setItem('diarioEmocional', JSON.stringify(registros));
            carregarHistorico();
            atualizarEstatisticas();
            mostrarToast('üóëÔ∏è Registro deletado');
        }

        function atualizarEstatisticas() {
            const registros = getRegistros();
            const total = registros.length;
            
            let somaIntensidade = 0;
            const contagemEmocoes = {};
            
            registros.forEach(r => {
                somaIntensidade += parseInt(r.intensidade);
                const emocao = r.emocaoCentral || r.emocao || 'N√£o especificada';
                contagemEmocoes[emocao] = (contagemEmocoes[emocao] || 0) + 1;
            });
            
            const mediaIntensidade = total > 0 ? (somaIntensidade / total).toFixed(1) : 0;
            const emocaoMaisFrequente = total > 0 
                ? Object.keys(contagemEmocoes).reduce((a, b) => contagemEmocoes[a] > contagemEmocoes[b] ? a : b)
                : 'N/A';

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${total}</div>
                    <div class="stat-label">REGISTROS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${mediaIntensidade}</div>
                    <div class="stat-label">INTENSIDADE M√âDIA</div>
                </div>
                <div class="stat-card" style="grid-column: 1 / -1;">
                    <div class="stat-value">${emocaoMaisFrequente}</div>
                    <div class="stat-label">EMO√á√ÉO MAIS FREQUENTE</div>
                </div>
            `;
        }

        function exportarPDF() {
            const registros = getRegistros();
            if (registros.length === 0) {
                mostrarToast('‚ö†Ô∏è Nenhum registro para exportar');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            let y = 20;
            const margemEsquerda = 15;
            const larguraPagina = 180;
            const alturaPagina = 280;
            
            // Cabe√ßalho
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('DI√ÅRIO EMOCIONAL - TCC', margemEsquerda, y);
            
            y += 8;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text('KEITE FABIOLA - PSIC√ìLOGA 04/58498', margemEsquerda, y);
            y += 5;
            doc.text('@PSIKEITEFABIOLA | (31) 9 8681-4865', margemEsquerda, y);
            y += 5;
            doc.text(`Exportado em: ${new Date().toLocaleString('pt-BR')}`, margemEsquerda, y);
            y += 10;
            
            doc.setLineWidth(0.5);
            doc.line(margemEsquerda, y, margemEsquerda + larguraPagina, y);
            y += 10;
            
            // Registros
            registros.forEach((reg, index) => {
                // Verificar se precisa de nova p√°gina
                if (y > alturaPagina - 40) {
                    doc.addPage();
                    y = 20;
                }
                
                // N√∫mero do registro
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(`Registro #${index + 1}`, margemEsquerda, y);
                y += 8;
                
                // Data/Hora
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('Data/Hora:', margemEsquerda, y);
                doc.setFont('helvetica', 'normal');
                doc.text(new Date(reg.dataHora).toLocaleString('pt-BR'), margemEsquerda + 30, y);
                y += 7;
                
                // Situa√ß√£o
                doc.setFont('helvetica', 'bold');
                doc.text('Situa√ß√£o:', margemEsquerda, y);
                y += 5;
                doc.setFont('helvetica', 'normal');
                const linhasSituacao = doc.splitTextToSize(reg.situacao, larguraPagina);
                doc.text(linhasSituacao, margemEsquerda, y);
                y += (linhasSituacao.length * 5) + 2;
                
                // Pensamento
                if (y > alturaPagina - 30) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('Pensamento Autom√°tico:', margemEsquerda, y);
                y += 5;
                doc.setFont('helvetica', 'normal');
                const linhasPensamento = doc.splitTextToSize(reg.pensamento, larguraPagina);
                doc.text(linhasPensamento, margemEsquerda, y);
                y += (linhasPensamento.length * 5) + 2;
                
                // Emo√ß√£o
                if (y > alturaPagina - 25) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('Emo√ß√£o:', margemEsquerda, y);
                doc.setFont('helvetica', 'normal');
                const emocaoCentral = reg.emocaoCentral || reg.emocao || '';
                const emocaoInter = reg.emocaoIntermediaria || '';
                const emocaoEsp = reg.emocaoEspecifica || '';
                doc.text(`${emocaoCentral} > ${emocaoInter} > ${emocaoEsp}`, margemEsquerda + 25, y);
                y += 7;
                
                // Intensidade
                doc.setFont('helvetica', 'bold');
                doc.text('Intensidade:', margemEsquerda, y);
                doc.setFont('helvetica', 'normal');
                doc.text(`${reg.intensidade}/10`, margemEsquerda + 30, y);
                y += 7;
                
                // Comportamento
                if (y > alturaPagina - 25) {
                    doc.addPage();
                    y = 20;
                }
                doc.setFont('helvetica', 'bold');
                doc.text('Comportamento:', margemEsquerda, y);
                y += 5;
                doc.setFont('helvetica', 'normal');
                const linhasComportamento = doc.splitTextToSize(reg.comportamento, larguraPagina);
                doc.text(linhasComportamento, margemEsquerda, y);
                y += (linhasComportamento.length * 5) + 8;
                
                // Linha separadora
                if (index < registros.length - 1) {
                    if (y > alturaPagina - 15) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.setLineWidth(0.3);
                    doc.setDrawColor(200, 200, 200);
                    doc.line(margemEsquerda, y, margemEsquerda + larguraPagina, y);
                    y += 10;
                }
            });
            
            // Salvar PDF
            const nomeArquivo = `diario-emocional-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(nomeArquivo);
            mostrarToast('‚úÖ PDF baixado com sucesso!');
        }

        function exportarJSON() {
            const registros = getRegistros();
            const blob = new Blob([JSON.stringify(registros, null, 2)], { type: 'application/json' });
            baixarArquivo(blob, `diario-emocional-${new Date().toISOString().split('T')[0]}.json`);
            mostrarToast('üì• JSON baixado!');
        }

        function exportarCSV() {
            const registros = getRegistros();
            let csv = 'Data,Hora,Situa√ß√£o,Pensamento,Emo√ß√£o Central,Emo√ß√£o Intermedi√°ria,Emo√ß√£o Espec√≠fica,Intensidade,Comportamento\n';
            
            registros.forEach(r => {
                const data = new Date(r.dataHora);
                const linha = [
                    data.toLocaleDateString('pt-BR'),
                    data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}),
                    `"${r.situacao.replace(/"/g, '""')}"`,
                    `"${r.pensamento.replace(/"/g, '""')}"`,
                    r.emocaoCentral || r.emocao || '',
                    r.emocaoIntermediaria || '',
                    r.emocaoEspecifica || '',
                    r.intensidade,
                    `"${r.comportamento.replace(/"/g, '""')}"`
                ].join(',');
                csv += linha + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            baixarArquivo(blob, `diario-emocional-${new Date().toISOString().split('T')[0]}.csv`);
            mostrarToast('üì• CSV baixado!');
        }

        function exportarTexto() {
            const registros = getRegistros();
            let texto = 'DI√ÅRIO EMOCIONAL - REGISTRO TCC\n';
            texto += '='.repeat(50) + '\n\n';
            
            registros.forEach((r, i) => {
                const data = new Date(r.dataHora);
                texto += `REGISTRO ${i + 1}\n`;
                texto += `Data: ${data.toLocaleDateString('pt-BR')} √†s ${data.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})}\n\n`;
                texto += `SITUA√á√ÉO:\n${r.situacao}\n\n`;
                texto += `PENSAMENTO AUTOM√ÅTICO:\n${r.pensamento}\n\n`;
                const emocaoCentral = r.emocaoCentral || r.emocao || 'N√£o especificada';
                const emocaoIntermediaria = r.emocaoIntermediaria || '';
                const emocaoEspecifica = r.emocaoEspecifica || '';
                texto += `EMO√á√ÉO: ${emocaoCentral}`;
                if (emocaoIntermediaria) texto += ` ‚Üí ${emocaoIntermediaria}`;
                if (emocaoEspecifica) texto += ` ‚Üí ${emocaoEspecifica}`;
                texto += ` (Intensidade: ${r.intensidade}/10)\n\n`;
                texto += `COMPORTAMENTO:\n${r.comportamento}\n\n`;
                texto += '-'.repeat(50) + '\n\n';
            });
            
            const blob = new Blob([texto], { type: 'text/plain;charset=utf-8;' });
            baixarArquivo(blob, `diario-emocional-${new Date().toISOString().split('T')[0]}.txt`);
            mostrarToast('üì• TXT baixado!');
        }

        function baixarArquivo(blob, nomeArquivo) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = nomeArquivo;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function limparTodosDados() {
            if (!confirm('‚ö†Ô∏è ATEN√á√ÉO! Isso vai apagar TODOS os seus registros permanentemente. Tem certeza?')) return;
            if (!confirm('√öltima confirma√ß√£o: Todos os dados ser√£o perdidos. Continuar?')) return;
            
            localStorage.removeItem('diarioEmocional');
            carregarHistorico();
            atualizarEstatisticas();
            mostrarToast('üóëÔ∏è Todos os dados foram apagados');
        }

        function mostrarToast(mensagem) {
            const toast = document.getElementById('toast');
            toast.textContent = mensagem;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>